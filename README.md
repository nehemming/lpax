# lpax

Strong keyed string repository supporting internationalisation and separation of text definition from usage.

 * [Installation](#install) 
 * [Features](#features)
 * [Contributing](#contrib)
 * [License](#license)

## Status

![Status](https://img.shields.io/badge/Status-ALPHA-red?style=for-the-badge)
[![Build Status](https://img.shields.io/circleci/build/gh/nehemming/lpax/master?style=for-the-badge)](https://github.com/nehemming/lpax) 
[![Release](https://img.shields.io/github/v/release/nehemming/lpax.svg?style=for-the-badge)](https://github.com/nehemming/lpax/releases/latest)
[![Coveralls](https://img.shields.io/coveralls/github/nehemming/lpax?style=for-the-badge)](https://coveralls.io/github/nehemming/lpax)
[![License](https://img.shields.io/badge/License-Apache%202.0-blue.svg?style=for-the-badge)](#license)
[![GoReportCard](https://goreportcard.com/badge/github.com/nehemming/lpax?test=0&style=for-the-badge)](https://goreportcard.com/report/github.com/nehemming/lpax)
[![Go Doc](https://img.shields.io/badge/godoc-reference-blue.svg?style=for-the-badge)](http://godoc.org/github.com/nehemming/cirocket)
[![Conventional Commits](https://img.shields.io/badge/Conventional%20Commits-1.0.0-yellow.svg?style=for-the-badge)](https://conventionalcommits.org)
[![Uses: cirocket](https://img.shields.io/badge/Uses-cirocket-orange?style=for-the-badge)](https://github.com/nehemming/cirocket)
[![Uses: GoReleaser](https://img.shields.io/badge/uses-goreleaser-green.svg?style=for-the-badge)](https://github.com/goreleaser)

## <a name="install">Installation

To add lpax to a project run:

```sh
go get github.com/nehemming/cirocket@latest
```

lpax supports modules.

## <a name="features"></a>Features

Applications and library packages typically embed string and error messages within the code.  Placing strings inline within the code can make it harder to internationalise the code or to extract a list of all error messages generated by an application.  `lpax` provides method of registering strings that can be accessed via decentralised keys.  The key system uses Go's strong typing to allow each package to create its own key system without risking overlapping with other packages keys.  multiple languages can be supported for key, with fallback logic to us the default `english` language.

 * String registration is implemented via the `Registry` interface.  Packages can use their own registry instance but in most cases will use the shared `Default` registry.
 * Strongly typed keys (`TextID`'s) ensure each package has isolated keys.  Keys may be of int, uint, string or struct kinds.
 * Keys may be registered in multiple languages, allowing localized versions of the text to be used within an application.
 * Single and plural versions of a text message can be stored.
 * Applications can register overrides for messages registered by a package using the `priority` parameter of `Register`
 * Attach a `TextFinder` instance to a context, allowing different contexts to operate in different languages.
 * Helper `Sprintf` and `Errorf` functions supporting `TextID` implemented.

### Typical implementation

Packages / applications wishing to use `lpax` will typically implement their own sub package containing the messages, or load them from an external source.

The example [pack_example_test.go](https://github.com/nehemming/lpax/blob/master/pack_example_test.go) source shows a typical language package implementation.

It creates package `PackID` and `TextID` types (used as the package unique id amd message keys respectively) and registers the messages against the default registry using the `init` function.

```go
type (
	// PackID is the local package id.
	// Each package should implement its own PackID type.
	// They are typically derived from the `int` type.
	PackID int

	// TextID is the id type for all messages defined by this package.
	// the TextID type must implement the lpax.TextID interface, but is typically
	// based on a `int` type.  As the package defines its own TextID it is
	// unique from other package types, and thus so are the ids.
	TextID int
)
```

```go
var pack = lpax.TextMap{
	Hello:  "Hello World",
	-Hello: "Hello Worlds",
}

// register is the text registry callback function used to return the text mappings.
func register(packID lpax.PackID, langTag lpax.Tag) lpax.TextMap {
	return pack
}

func init() {
	// register the text mappings with the share test registry.
	lpax.Default().Register(ExamplePackID, register, lpax.DefaultPriority, language.English)
}
```

Users of the messages can then use the lpax `Sprintf`, `CtxSprintf`, `Errorf` or `CtxErrorf` methods to output the messages. 

```go
func Example() {
	fmt.Println(lpax.Sprintf(Hello))
	fmt.Println(lpax.Sprintf(Hello.Plural()))

	// Output:
	// Hello World
	// Hello Worlds
}

```

Messages can also be retrieved by calling `Default().Text(id)`

## <a name="contrib"></a>Contributing

We would welcome contributions to this project.  Please read our [CONTRIBUTION](https://github.com/nehemming/lpax/blob/master/CONTRIBUTING.md) file for further details on how you can participate or report any issues.

## <a name="license"></a>License

[![FOSSA Status](https://app.fossa.com/api/projects/custom%2B26823%2Fgit%40github.com%3Anehemming%2Flpax.git.svg?type=small)](https://app.fossa.com/projects/custom%2B26823%2Fgit%40github.com%3Anehemming%2Flpax.git?ref=badge_small)

This software is licensed under the [Apache License](https://github.com/nehemming/lpax/blob/master/LICENSE). 